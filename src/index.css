@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
@import './styles/theme.css';
body{ font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Konsekvent typografi fÃ¶r hela appen */
@layer base {
  h1, h2, h3, h4, h5, h6 {
    font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
    letter-spacing: -0.05em;
    font-weight: 700;
  }
}

@layer base {
  :root {
    --accent-green: #10b981;
    --accent-cyan: #06b6d4;
    --accent-blue: #3b82f6;
    --accent-red: #ef4444;
    --error-red: #E45855;
    /* Flowship tokens */
    --border-subtle: rgba(139,135,255,0.15);
    --panel-a: #1E293B;
    --panel-b: rgba(30,41,59,0.70);
    /* Primary purple for neon glow */
    --primary-purple: #8B5CF6;
    --primary-purple-rgb: 139, 92, 246;
  }
  
  /* Base styles for HTML, body and root - ensure black background */
  html, body {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    overflow-x: hidden; /* Prevent horizontal scrollbar */
    font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
  }

  /* Root container styles */
  #root {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    overflow-x: hidden; /* Prevent horizontal scrollbar */
    overflow-y: auto; /* Allow vertical scrolling */
    background-color: transparent; /* Allow root to be transparent against black body */
    position: relative;
    transform-style: preserve-3d; /* Force a stacking context */
    -webkit-transform-style: preserve-3d; /* For Safari */
    isolation: isolate; /* Create stacking context */
    max-width: 100vw;
    max-height: 100vh;
  }
  
  /* Ensure canvas elements can be seen */
  canvas.starfield-canvas {
    backface-visibility: visible;
    will-change: transform;
  }
}

@layer components {
  .goalInput {
    font-size: 0.85rem; /* Avoid @apply with arbitrary values */
    @apply px-4 py-2 border rounded-lg 
      focus:outline-none focus:ring-2 focus:ring-blue-500 
      dark:bg-gray-700 dark:border-gray-600 dark:text-white 
      dark:placeholder-gray-400 dark:focus:ring-blue-400
      disabled:bg-gray-100 dark:disabled:bg-gray-800 
      disabled:text-gray-500 dark:disabled:text-gray-400;
  }

  /* Unified mission input styling (used by Mission Board and Goal Panel) */
  .mission-input {
    @apply px-3.5 py-2.5 rounded-md border 
      bg-white/70 dark:bg-gray-700/60 
      focus:outline-none focus:ring-2 focus:ring-violet-400 dark:focus:ring-violet-300
      disabled:opacity-60 disabled:cursor-not-allowed;
    border-color: rgba(139,135,255,0.30);
  }
  .dark .mission-input {
    border-color: rgba(139,135,255,0.28);
  }

  /* System Log project dropdown - clearer emerald frame */
  .syslog-select {
    /* dark glass background */
    background: linear-gradient(180deg, rgba(31,41,55,0.86), rgba(17,24,39,0.86));
    border: 2px solid rgba(16,185,129,0.72); /* thicker emerald frame */
    color: #e7f8ef; /* soft emerald-tinted text */
    border-radius: 10px;
    /* subtle inner and outer glow without being too flashy */
    box-shadow:
      0 0 0 1px rgba(16,185,129,0.28) inset,
      0 1px 2px rgba(0,0,0,0.35),
      0 0 0 2px rgba(16,185,129,0.20), /* outer ring */
      0 0 12px rgba(16,185,129,0.22);
    transition: box-shadow 160ms ease, border-color 160ms ease, background-color 160ms ease;
  }
  .syslog-select:hover {
    border-color: rgba(16,185,129,0.85);
    box-shadow:
      0 0 0 1px rgba(16,185,129,0.40) inset,
      0 2px 4px rgba(0,0,0,0.38),
      0 0 0 2px rgba(16,185,129,0.28),
      0 0 14px rgba(16,185,129,0.26);
  }
  .syslog-select:focus {
    outline: none;
    border-color: rgba(16,185,129,0.95);
    box-shadow:
      0 0 0 1px rgba(16,185,129,0.55) inset,
      0 0 0 3px rgba(16,185,129,0.40), /* stronger outer ring */
      0 0 18px rgba(16,185,129,0.32);
  }
  .dark .syslog-select option {
    background-color: #0b0f19; /* avoid white options pop */
    color: #d1fae5;
  }


  /* Neon glow variant for timer controls (keeps glass bg, removes border) */
  .panel-glass--neon {
    border: none;
    /* Multi-layer neon purple glow per style guide intent */
    box-shadow:
      0 0 0 2px rgba(var(--primary-purple-rgb), 0.45),
      0 0 14px rgba(var(--primary-purple-rgb), 0.55),
      0 0 28px rgba(var(--primary-purple-rgb), 0.35),
      0 0 56px rgba(var(--primary-purple-rgb), 0.25);
  }

  /* Premium glass cockpit wrapper for side panels */
  .panel-cockpit {
    /* Override base radius to match spec (16px) */
    border-radius: 16px;
    /* Subtle multi-layer glow + depth */
    box-shadow:
      inset 0 0 0 1px rgba(var(--primary-purple-rgb), 0.08),
      0 8px 24px rgba(0, 0, 0, 0.35),
      0 0 24px rgba(var(--primary-purple-rgb), 0.10);
    transition: box-shadow 250ms ease, transform 200ms ease;
  }

  .panel-cockpit:hover {
    box-shadow:
      inset 0 0 0 1px rgba(var(--primary-purple-rgb), 0.10),
      0 12px 28px rgba(0, 0, 0, 0.40),
      0 0 32px rgba(var(--primary-purple-rgb), 0.18);
    transform: translateY(-1px) scale(1.01);
  }

  /* Disable hover growth for specific panels (e.g., Session History) */
  .panel-cockpit.panel-static { 
    transition: none; 
  }
  .panel-cockpit.panel-static:hover {
    /* Keep default resting shadow and prevent transform */
    box-shadow:
      inset 0 0 0 1px rgba(var(--primary-purple-rgb), 0.08),
      0 8px 24px rgba(0, 0, 0, 0.35),
      0 0 24px rgba(var(--primary-purple-rgb), 0.10);
    transform: none;
  }

  .panel-cockpit:focus-within {
    /* Accessible focus emphasis */
    box-shadow:
      0 0 0 2px rgba(var(--primary-purple-rgb), 0.25),
      0 8px 24px rgba(0, 0, 0, 0.35),
      0 0 36px rgba(var(--primary-purple-rgb), 0.22);
    outline: none;
  }

  @media (prefers-reduced-motion: reduce) {
    .panel-cockpit,
    .panel-cockpit:hover {
      transition: none;
      transform: none;
    }
  }
  
  /* Lower Deck / Engine Bay headers - subtle neon header bar */
  .panel-cockpit[data-panel-id="environment"] > div:first-child,
  .panel-v2[data-panel-id="environment"] > div:first-child,
  .panel-cockpit[data-panel-id="posture-tracker"] > div:first-child,
  .panel-v2[data-panel-id="posture-tracker"] > div:first-child,
  .panel-cockpit[data-panel-id="flow-music"] > div:first-child,
  .panel-v2[data-panel-id="flow-music"] > div:first-child,
  .panel-cockpit[data-panel-id="deck-b"] > div:first-child,
  .panel-v2[data-panel-id="deck-b"] > div:first-child {
    background: linear-gradient(90deg, rgba(var(--primary-purple-rgb), 0.10), rgba(16,185,129,0.06) 40%, rgba(59,130,246,0.05));
    border-bottom: 1px solid rgba(var(--primary-purple-rgb), 0.14);
    box-shadow: inset 4px 0 0 rgba(var(--primary-purple-rgb), 0.25);
  }

  /* Remove any visual underline/rail on headers for all panels except Mission Board and System Log */
  .panel-v2:not([data-panel-id="mission-board"]):not([data-panel-id="system-log"]) > div:first-child,
  .panel-cockpit:not([data-panel-id="mission-board"]):not([data-panel-id="system-log"]) > div:first-child {
    border: none !important;
    border-bottom: none !important;
    box-shadow: none !important;         /* remove inset rail/shadow dividers */
    background: transparent !important;  /* remove gradient header bars */
    background-image: none !important;
  }

  /* Ensure no decorative divider under headers for most panels */
  .panel-v2:not([data-panel-id="mission-board"]):not([data-panel-id="system-log"]) > div:first-child.panel-divider::after,
  .panel-cockpit:not([data-panel-id="mission-board"]):not([data-panel-id="system-log"]) > div:first-child.panel-divider::after {
    display: none !important;
  }

  /* Remove any underline from subtitle rows and nested elements in headers for most panels */
  .panel-v2:not([data-panel-id="mission-board"]):not([data-panel-id="system-log"]) > div:first-child *,
  .panel-cockpit:not([data-panel-id="mission-board"]):not([data-panel-id="system-log"]) > div:first-child * {
    border: none !important;
    text-decoration: none !important;
    box-shadow: none !important;
    background: transparent !important;
  }

  /* Remove section separators (border-t / border-b) inside panel content for most panels */
  .panel-v2:not([data-panel-id="mission-board"]):not([data-panel-id="system-log"]) > div:nth-child(2) [class*="border-t"],
  .panel-cockpit:not([data-panel-id="mission-board"]):not([data-panel-id="system-log"]) > div:nth-child(2) [class*="border-t"] {
    border-top: 0 !important;
    border-top-color: transparent !important;
  }
  .panel-v2:not([data-panel-id="mission-board"]):not([data-panel-id="system-log"]) > div:nth-child(2) [class*="border-b"],
  .panel-cockpit:not([data-panel-id="mission-board"]):not([data-panel-id="system-log"]) > div:nth-child(2) [class*="border-b"] {
    border-bottom: 0 !important;
    border-bottom-color: transparent !important;
  }
  .panel-v2:not([data-panel-id="mission-board"]):not([data-panel-id="system-log"]) > div:nth-child(2) hr,
  .panel-cockpit:not([data-panel-id="mission-board"]):not([data-panel-id="system-log"]) > div:nth-child(2) hr {
    display: none !important;
  }

  /* Neon glow pulse animation */
  @keyframes neon-pulse {
    0%, 100% {
      opacity: 0.995;
      filter: brightness(1) saturate(1);
    }
    50% {
      opacity: 0.990;
      filter: brightness(1.015) saturate(1.01);
    }
  }

  /* HERO glow for the whole timer module */
  .glow-hero {
    /* same radius as our cards */
    border-radius: 16px; /* rounded-2xl equivalent */
    /* subtle, diffuse neon base (no hard rings) */
    --gh-border-alpha: 0.14;
    --gh-inset-alpha: 0.08;
    --gh-purple-a1: 0.08;
    --gh-blue-a2: 0.06;
    --gh-blur1: 20px;
    --gh-blur2: 42px;
    /* pulse variables (overridden by intensity variants) */
    --gh-pulse-duration: 8.5s;        /* long, mesmerizing */
    --gh-ring-duration: 3.6s;         /* secondary subtle ring wave */
    --gh-wave-alpha: 0.14;            /* outer radial glow opacity */
    --gh-wave-blur: 12px;             /* softness of wave */
    --gh-ring-alpha: 0.18;            /* ring halo opacity (edge-hugging) */
    --gh-ring-spread: 16px;           /* how far ring expands (closer to line) */
    /* new incremental controls */
    --gh-edge-ring-alpha: 0.16;       /* crisp 2px edge accent */
    --gh-inner-glow: 0.06;            /* inset softening at the edge */
    --gh-hue-rotate: 0deg;            /* subtle hue shift at higher tiers */
    --gh-wave2-alpha: 0;              /* secondary larger wave for s3+ */
    --gh-wave-o-min: 0.34;            /* wave opacity min (used in keyframes) */
    --gh-wave-o-max: 0.62;            /* wave opacity max */
    --gh-scale-min: 0.995;            /* wave scale min */
    --gh-scale-max: 1.010;            /* wave scale max */
    --gh-phase-offset: 0s;            /* phase delay for ring vs wave */
    position: relative;
    isolation: isolate;               /* contain pseudo-element z-index */
    border: 1px solid rgba(147, 51, 234, var(--gh-border-alpha));
    box-shadow:
      0 0 0 1px rgba(147, 51, 234, var(--gh-inset-alpha)) inset,
      inset 0 0 8px rgba(147, 51, 234, var(--gh-inner-glow)),
      0 0 0 2px rgba(147, 51, 234, var(--gh-edge-ring-alpha)),
      0 10px 24px rgba(0, 0, 0, 0.38),
      0 0 var(--gh-blur1) rgba(147, 51, 234, var(--gh-purple-a1)),
      0 0 var(--gh-blur2) rgba(59, 130, 246, var(--gh-blue-a2));
    animation: neon-pulse 8s ease-in-out infinite;
    transition: box-shadow 320ms ease, border-color 320ms ease, filter 320ms ease;
  }

  /* Radiating violet pulse (soft, contained within panel area) */
  .glow-hero::after {
    content: "";
    position: absolute;
    inset: -4px; /* bring the wave closer to the edge */
    border-radius: inherit;
    pointer-events: none;
    z-index: 0; /* below content (content should set z-index: 1/10) */
    background:
      radial-gradient(
        60% 60% at 50% 50%,
        rgba(var(--primary-purple-rgb), var(--gh-wave-alpha)) 0%,
        rgba(var(--primary-purple-rgb), calc(var(--gh-wave-alpha) * 0.75)) 22%,
        rgba(59,130,246, calc(var(--gh-wave-alpha) * 0.55)) 44%,
        rgba(0,0,0,0) 70%
      ),
      radial-gradient(
        90% 90% at 50% 50%,
        rgba(59,130,246, var(--gh-wave2-alpha)) 0%,
        rgba(59,130,246, calc(var(--gh-wave2-alpha) * 0.6)) 20%,
        rgba(0,0,0,0) 85%
      );
    filter: hue-rotate(var(--gh-hue-rotate)) blur(var(--gh-wave-blur));
    transform: scale(var(--gh-scale-min));
    animation: glow-wave var(--gh-pulse-duration) ease-in-out infinite;
    animation-delay: calc(var(--gh-phase-offset) * 0.6);
  }

  /* Expanding soft halo ring for a gentle wavefront */
  .glow-hero::before {
    content: "";
    position: absolute;
    inset: -1px; /* edge-hugging ring */
    border-radius: inherit;
    pointer-events: none;
    z-index: 0;
    box-shadow: 0 0 0 0 rgba(var(--primary-purple-rgb), var(--gh-ring-alpha));
    animation: glow-ring var(--gh-ring-duration) ease-in-out infinite;
    animation-delay: var(--gh-phase-offset);
  }

  @keyframes glow-wave {
    0%   { opacity: var(--gh-wave-o-min); transform: scale(var(--gh-scale-min)); }
    50%  { opacity: var(--gh-wave-o-max); transform: scale(var(--gh-scale-max)); }
    100% { opacity: var(--gh-wave-o-min); transform: scale(var(--gh-scale-min)); }
  }

  @keyframes glow-ring {
    0%   { box-shadow: 0 0 0 0 rgba(var(--primary-purple-rgb), var(--gh-ring-alpha)); }
    70%  { box-shadow: 0 0 0 var(--gh-ring-spread) rgba(var(--primary-purple-rgb), 0); }
    100% { box-shadow: 0 0 0 0 rgba(var(--primary-purple-rgb), 0); }
  }

  /* Streak intensity variants - Neon purple to blue gradient */
  .glow-hero--s1 {
    /* slight increase via variables; no extra ring layers */
    --gh-border-alpha: 0.11;
    --gh-inset-alpha: 0.06;
    --gh-purple-a1: 0.085;
    --gh-blue-a2: 0.065;
    --gh-blur1: 22px;
    --gh-blur2: 46px;
    --gh-wave-alpha: 0.22;
    --gh-wave-blur: 12px;
    --gh-ring-alpha: 0.22;
    --gh-ring-spread: 18px;
    --gh-edge-ring-alpha: 0.20;
    --gh-inner-glow: 0.08;
    --gh-wave2-alpha: 0;
    --gh-hue-rotate: 0deg;
    --gh-wave-o-min: 0.36;
    --gh-wave-o-max: 0.60;
    --gh-scale-min: 0.996;
    --gh-scale-max: 1.008;
    --gh-phase-offset: 0s;
    --gh-pulse-duration: 8.2s;
    --gh-ring-duration: 3.4s;
  }

  .glow-hero--s2 {
    --gh-border-alpha: 0.115;
    --gh-inset-alpha: 0.065;
    --gh-purple-a1: 0.09;
    --gh-blue-a2: 0.07;
    --gh-blur1: 24px;
    --gh-blur2: 50px;
    --gh-wave-alpha: 0.26;
    --gh-wave-blur: 13px;
    --gh-ring-alpha: 0.26;
    --gh-ring-spread: 20px;
    --gh-edge-ring-alpha: 0.22;
    --gh-inner-glow: 0.10;
    --gh-wave2-alpha: 0;
    --gh-hue-rotate: 0deg;
    --gh-wave-o-min: 0.36;
    --gh-wave-o-max: 0.62;
    --gh-scale-min: 0.995;
    --gh-scale-max: 1.010;
    --gh-phase-offset: 0.08s;
    --gh-pulse-duration: 7.8s;
    --gh-ring-duration: 3.25s;
  }

  .glow-hero--s3 {
    --gh-border-alpha: 0.12;
    --gh-inset-alpha: 0.07;
    --gh-purple-a1: 0.095;
    --gh-blue-a2: 0.075;
    --gh-blur1: 26px;
    --gh-blur2: 54px;
    --gh-wave-alpha: 0.30;
    --gh-wave-blur: 14px;
    --gh-ring-alpha: 0.30;
    --gh-ring-spread: 22px;
    --gh-edge-ring-alpha: 0.25;
    --gh-inner-glow: 0.12;
    --gh-wave2-alpha: 0.05;  /* start secondary wave */
    --gh-hue-rotate: 6deg;
    --gh-wave-o-min: 0.38;
    --gh-wave-o-max: 0.66;
    --gh-scale-min: 0.994;
    --gh-scale-max: 1.012;
    --gh-phase-offset: 0.14s;
    --gh-pulse-duration: 7.0s;
    --gh-ring-duration: 3.0s;
  }

  .glow-hero--s4 {
    --gh-border-alpha: 0.125;
    --gh-inset-alpha: 0.075;
    --gh-purple-a1: 0.10;
    --gh-blue-a2: 0.08;
    --gh-blur1: 28px;
    --gh-blur2: 58px;
    --gh-wave-alpha: 0.33;
    --gh-wave-blur: 15px;
    --gh-ring-alpha: 0.33;
    --gh-ring-spread: 24px;
    --gh-edge-ring-alpha: 0.28;
    --gh-inner-glow: 0.14;
    --gh-wave2-alpha: 0.08;
    --gh-hue-rotate: 10deg;
    --gh-wave-o-min: 0.40;
    --gh-wave-o-max: 0.68;
    --gh-scale-min: 0.993;
    --gh-scale-max: 1.014;
    --gh-phase-offset: 0.22s;
    --gh-pulse-duration: 6.4s;
    --gh-ring-duration: 2.9s;
  }

  .glow-hero--s5 {
    /* keep subtle, no animated gradient border; just a touch more diffuse */
    --gh-border-alpha: 0.13;
    --gh-inset-alpha: 0.08;
    --gh-purple-a1: 0.105;
    --gh-blue-a2: 0.085;
    --gh-blur1: 30px;
    --gh-blur2: 66px;
    --gh-wave-alpha: 0.38;
    --gh-wave-blur: 16px;
    --gh-ring-alpha: 0.36;
    --gh-ring-spread: 28px;
    --gh-edge-ring-alpha: 0.32;
    --gh-inner-glow: 0.16;
    --gh-wave2-alpha: 0.12;
    --gh-hue-rotate: 14deg;
    --gh-wave-o-min: 0.42;
    --gh-wave-o-max: 0.72;
    --gh-scale-min: 0.992;
    --gh-scale-max: 1.017;
    --gh-phase-offset: 0.30s;
    --gh-pulse-duration: 5.8s;
    --gh-ring-duration: 2.7s;
  }

  /* Accessibility: honor reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .glow-hero,
    .glow-hero::before,
    .glow-hero::after {
      animation: none !important;
    }
  }

  @keyframes gradient-shift {
    0% { background-position: 0% 50%; }
    100% { background-position: 200% 50%; }
  }

  /* Temporary debug outline for verification */
  .debug-ui .panel-glass {
    outline: 2px solid #8B5CF6 !important; /* violet */
  }
}

@layer utilities {
  /* Animation for toast notifications */
  .animate-fade-in-scale {
    animation: fade-in-scale 0.3s ease-out forwards;
  }
  
  @keyframes fade-in-scale {
    from { 
      opacity: 0; 
      transform: translateY(20px) translateX(-50%); 
    }
    to { 
      opacity: 1; 
      transform: translateY(0) translateX(-50%); 
    }
  }

  /* Fade in and move up slightly, without horizontal translate (for centered modals) */
  .animate-fade-in-up {
    animation: fade-in-up 0.22s ease-out forwards;
  }

  @keyframes fade-in-up {
    from {
      opacity: 0;
      transform: translateY(12px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Line paper background for notepad */
  .bg-size-100\%-1\.5rem {
    background-size: 100% 1.5rem;
  }

  /* Improved thrust shake animation - reduced displacement to prevent edge artifacts */
  @keyframes thrustShake {
    0% { transform: translate(0, 0) scale(1.001); }
    10% { transform: translate(-0.7px, -0.7px) scale(1.001); }
    20% { transform: translate(0.7px, -0.3px) scale(1.001); }
    30% { transform: translate(-0.3px, 0.7px) scale(1.001); }
    40% { transform: translate(0.3px, -0.3px) scale(1.001); }
    50% { transform: translate(-0.3px, 0.7px) scale(1.001); }
    60% { transform: translate(-0.7px, 0.3px) scale(1.001); }
    70% { transform: translate(0.7px, 0.3px) scale(1.001); }
    80% { transform: translate(-0.3px, -0.3px) scale(1.001); }
    90% { transform: translate(0.3px, 0.7px) scale(1.001); }
    100% { transform: translate(0, 0) scale(1.001); }
  }

  .thrust-shake {
    animation: thrustShake 0.15s cubic-bezier(.36,.07,.19,.97) both;
    transform-origin: center;
    background-color: black !important; /* Force black background during shake */
    overflow: hidden; /* Hide any overflow during animation */
    outline: 1px solid black; /* Add outline to prevent edge artifacts */
  }

  /* Subtle terminal scanlines (used on System Log scroll area) */
  .terminal-gridlines::before {
    content: "";
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(16,185,129,0.035) 2px,
      rgba(16,185,129,0.035) 4px
    );
    pointer-events: none;
  }

  /* Optional shimmer for primary buttons (used by Add / Start Goal) */
  .btn-shimmer::before {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
    transform: translateX(-100%);
    transition: transform 300ms ease-out;
  }
  .btn-shimmer:hover::before { transform: translateX(100%); }

  /* Subtle purple radial glow behind timer digits (contained within column) */
  .digit-glow { position: relative; overflow: hidden; }
  .digit-glow::before {
    content: "";
    position: absolute;
    inset: 12%; /* shrink so the fade ends before column edges */
    background: radial-gradient(52% 52% at 50% 50%, rgba(var(--primary-purple-rgb), 0.10) 0%, rgba(var(--primary-purple-rgb), 0.06) 30%, rgba(0,0,0,0) 52%);
    filter: blur(6px);
    pointer-events: none;
    z-index: 0;
  }

  /* Keep number input arrows visible but remove their white background in Chromium */
  .no-spin-bg { color-scheme: dark; appearance: textfield; -moz-appearance: textfield; }
  .no-spin-bg::-webkit-inner-spin-button,
  .no-spin-bg::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
    background: transparent;
    border: none;
  }
}